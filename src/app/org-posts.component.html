<div class="clearfix posts-container" [attr.id]="!isBrowsing ? 'posts' : null" [ngClass]="{'posts-by-org': org, 'browsing': isBrowsing, 'col-md-12': org && !isBrowsing}">

	<header [ngClass]="{'col-md-12': org && !isBrowsing}">
		<h4 class="posts-title" *ngIf="org">What we're up to</h4>
		<h2 class="posts-title" *ngIf="!org && isBrowsing">What they're up to</h2>

		<p *ngIf="!org" class="subtitle">See where your money's going</p>
		<search-box
			class="search-box-container clearfix"
			*ngIf="(!org?._id || !isBrowsing) && !isLoading"
			(update)="searchPosts($event)"
			(focusChange)="toggleSearchBoxFocus($event)"
			[ngClass]="{focused: searchBoxIsFocused}"
			[collection]="searchPlaceholder"></search-box>
	</header>

	<!-- Posts -->
	<div [ngClass]="{'col-md-12': org && !isBrowsing}">
		<section *ngIf="!viewingOne && posts?.length" class="posts col-md-12" [ngClass]="{'is-loading': loadingPosts}">
			<create-post *ngIf="org && user && userHasPermission(org) && !isBrowsing" [org]="org" [user]="user" (update)="updatePosts($event)"></create-post>
			<div #singlePost
					class="post clearfix"
					[ngClass]="{'has-featured-image': post?.featuredImage?.length}"
					*ngFor="let post of posts">
				<div *ngIf="!org"
						[ngStyle]="{'background-image': 'url(' + orgsByPost[post._id]?.avatar + ')'}"
						class="org-avatar bg-image"
						(click)="selectPost(post._id)"></div>
				<div class="post-inner">
					<p class="post-meta" *ngIf="!org"><strong class="post-org">{{orgsByPost[post._id]?.name}}</strong><span class="post-date">{{orgsByPost[post._id]?.dateCreated | date: MMMEEEEd}}</span></p>
					<h5 class="post-title" (click)="selectPost(post._id)">{{post.title}}</h5>
					<p class="post-content">{{post.content | truncate:100}}</p>
				</div>
			</div>
			<button *ngIf="posts.length > 19"
					id="show-more"
					(click)="showMore(10, posts.length)">Show more</button>
		</section>
		<section class="null-search col-md-12" *ngIf="!isLoading && posts.length === 0">
				<p>No posts to show.</p>
		</section>

		<!-- View Post -->
		<section *ngIf="viewingOne && selectedPost" class="col-md-12">
			<a (click)="deselectPost()" [routerLink]="['/organization/i', org?._id]">Back to posts</a>
			<img *ngIf="selectedPost?.featuredImage?.length" [src]="selectedPost.featuredImage" width="100">
			<div *ngIf="!isEditing">
				<h5>{{selectedPost.title}}</h5>
				<p>{{selectedPost.content}}</p>
			</div>
			<button *ngIf="userHasPermission(org)" (click)="editPost()">Edit</button>
			<div *ngIf="isEditing">
				<input [(ngModel)]="selectedPost.title">
				<textarea [(ngModel)]="selectedPost.content"></textarea>
				<button (click)="savePost(selectedPost)">Save</button>
			</div>
		</section>
	</div>
</div>