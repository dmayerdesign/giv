<div class="featured-orgs col-md-12">
	<div class="featured-orgs-inner row">

		<div class="featured-carousel-nav">
			<i class="fa fa-angle-left" (click)="cycleFeatured(-1)"></i>
			<i class="fa fa-angle-right" (click)="cycleFeatured(1)"></i>
		</div>
		<h4 class="featured-header">Featured</h4>
		<section class="org featured-org single-item"
				#singleItem
				*ngFor="let org of featuredOrgs"
				[ngClass]="{'hidden': !org.showing, 'has-cover-image': org.coverImage, 'has-video': org.videoLink}">

			<header
					[ngStyle]="{'background-image': org.coverImage ? 'url(' + org.coverImage + ')' : 'url(app/images/cover-icons-overlay.png)'}">
				<div class="header-inner">
					<img class="org-avatar inside-org" *ngIf="org.avatar" [src]="org.avatar" [alt]="org.name">

					<h4>
						<a *ngIf="org.slug" [routerLink]="['/organization', org.slug]">{{org.name}}</a>
						<a *ngIf="!org.slug" [routerLink]="['/organization', 'i', org._id]">{{org.name}}</a>
					</h4>
					<p class="info">
						<span class="star unstarred" *ngIf="user && !orgIsStarred(org)" (click)="starOrg(org)"><i class="fa fa-star-o"></i></span>
						<span class="star starred" *ngIf="user && orgIsStarred(org)" (click)="unstarOrg(org)"><i class="fa fa-star"></i></span>
						&nbsp;{{org.stars}} people starred this
					</p>
					<p class="description inside-org preview">{{org.description | truncate:280}}</p>

					<a [href]="org.donateLink" target="_blank"><button class="donate-button">{{org.donateLinkCopy || 'Donate'}}</button></a>
				</div>
			</header>
		</section>
		<div class="featured-footer featured-carousel-nav-dots">
			<span *ngFor="let org of featuredOrgs; let i = index"
			(click)="showFeatured(i)"
			[ngClass]="{'selected': featuredShowing === i}">â€¢</span>
		</div>
	</div>
</div>

<div class="col-md-7 browse-orgs" *ngIf="!isLoading">
	<header class="row col-md-12">
		<div class="row">
			<h2>Organizations</h2>
			<p class="subtitle">People doing important work right now</p>

			<search-box
			class="org-search-box search-box-container clearfix"
			*ngIf="!isLoading"
			(update)="searchOrgs($event)"
			(focusChange)="toggleSearchBoxFocus($event)"
			[ngClass]="{focused: searchBoxIsFocused}"
			[collection]="'organizations'"></search-box>

			<select *ngIf="!isLoading"
					[value]="categoryFilter?.id"
					(change)="filterByCategory(getCategoryById($event.target.value))">
				<option [value]="null" selected>All categories</option>
				<option *ngFor="let category of categoriesList" [value]="category?.id">{{category?.name}}</option>
			</select>

			<!-- <p class="info" *ngIf="orgsShowing">
				Showing {{orgsShowing || ''}} organization<span *ngIf="orgsShowing != 1">s</span>
			</p> -->
			<p class="info" *ngIf="searchText">
				<button class="mini" (click)="clearOrgSearch()"><i class="fa fa-undo"></i>Clear search</button>
			</p>
			<p class="info" *ngIf="categoryFilter.id">
				Category: {{categoryFilter.name}}&nbsp;&nbsp;
				<button class="mini" (click)="clearCategoryFilter()"><i class="fa fa-undo"></i>Clear filter</button>
			</p>
		</div>
	</header>

	<div class="row items-list orgs-list col-md-12"
			[ngClass]="{'loading-orgs': loadingOrgSearch, 'loading-more-orgs': loadingShowMoreOrgs}">

		<section class="null-search" *ngIf="orgs.length === 0">
				<p>No orgs to show. Try broadening your search.</p>
		</section>

	<!--*******
		Orgs Loop
		*********-->
		<section class="org single-item row"
				#singleItem
				*ngFor="let org of orgs"
				(clickOutside)="deselectOrg($event, org._id)"
				[ngClass]="{'selected': viewingOrg && org._id === selectedOrg._id, 'has-cover-image': org.coverImage, 'has-video': org.videoLink}">

			<header
					[ngStyle]="{'background-image': org.coverImage ? 'url(' + org.coverImage + ')' : 'url(app/images/cover-icons-overlay.png)'}"
					(click)="viewOrg($event, org._id)">
				<div class="header-inner">
					<div class="inside-org header-left">
						<div class="org-avatar inside-org" *ngIf="org.avatar" [ngStyle]="{'background-image': 'url(' + org.avatar + ')'}"></div>
					</div>
					<div class="inside-org header-right">
						<h4 class="inside-org org-name" *ngIf="!selectedOrg || org._id !== selectedOrg._id">{{org.name}}</h4>

						<p class="preview inside-org" *ngIf="!selectedOrg || org._id !== selectedOrg._id">{{org.description | truncate:150}}</p>
						<p *ngIf="org.stars" class="stars-preview preview info inside-org">
							<i *ngIf="user && orgIsStarred(org)" class="fa fa-star inside-org"></i>
							<i *ngIf="user && !orgIsStarred(org)" class="fa fa-star-o inside-org"></i>
							<strong class="inside-org">{{org.stars}}</strong>
						</p>

						<h4 class="org-name" *ngIf="viewingOrg && org._id === selectedOrg._id">
							<a *ngIf="org.slug" [routerLink]="['/organization', org.slug]">{{org.name}}</a>
							<a *ngIf="!org.slug" [routerLink]="['/organization', 'i', org._id]">{{org.name}}</a>
							<span class="manage-org" *ngIf="userHasPermission(org)"><a [routerLink]="['/organization', 'manage', org?._id]">Manage</a></span>
						</h4>
						<p class="info" *ngIf="viewingOrg && org._id === selectedOrg._id">
							<span class="star unstarred" *ngIf="user && !orgIsStarred(org)" (click)="starOrg(org)"><i class="fa fa-star-o"></i></span>
							<span class="star starred" *ngIf="user && orgIsStarred(org)" (click)="unstarOrg(org)"><i class="fa fa-star"></i></span>
							&nbsp;{{org.stars}} people starred this
						</p>
					</div>
				</div>
			</header>
			<span class="exit" (click)="deselectOrg($event, org._id)" *ngIf="viewingOrg && org._id === selectedOrg._id">
				<img src="app/images/x.svg" width="16" height="16" alt="exit">
			</span>

			<div class="org-expanded clearfix" *ngIf="viewingOrg && org._id === selectedOrg._id" [ngClass]="{'expanded': singleDetailsAreLoaded && singlePostsAreLoaded}">
				<org-details (update)="revealOrgDetails($event)" [org]="selectedOrg"></org-details>
				<org-posts (update)="revealOrgPosts($event)" [org]="selectedOrg" [isBrowsing]="true"></org-posts>
				<p class="read-more more-posts">
					<a *ngIf="org.slug" [routerLink]="['/organization', org.slug]">More posts by {{org.name}}</a>
					<a *ngIf="!org.slug" [routerLink]="['/organization', 'i', org._id]">More posts by {{org.name}}</a>
				</p>
			</div>
		</section>
		
		<button id="show-more"
				(click)="showMore(10, orgs.length)"
				[ngClass]="{'loading': loadingShowMoreOrgs}"
				[disabled]="loadingOrgSearch || isLoading">Show more</button>
	</div>

	<!-- LOADING SEARCH -->
	<div class="loader loading-org-search"
			[ngClass]="{'org-search-loader': loadingOrgSearch, 'show-more-loader': loadingShowMoreOrgs}"
			*ngIf="loadingOrgSearch || loadingShowMoreOrgs">
	  <div class="loader__figure"></div>
	</div>
</div>

<div class="col-md-5 browse-posts" *ngIf="!isLoading">
	<org-posts [user]="user" [isBrowsing]="true"></org-posts>
</div>

<!-- LOADING COMPONENT -->
<div class="loader" *ngIf="isLoading">
  <div class="loader__figure"></div>
  <p class="loader__label"><img src="images/logo-color-2x.png" width="30" alt="loading organizations"></p>
</div>

